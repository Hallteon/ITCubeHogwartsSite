{% extends 'main/base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'articles/css/articles.css' %}">
{% endblock %}

{% block content %}
{% if page_obj.has_other_pages %}
<section class="articles content">
{% else %}
<section class="articles content articles_one-page">
{% endif %}
    <div class="container-fluid articles-header">
        <div class="row">
            <div class="col-12">
                <div class="container">
                    <nav class="row justify-content-between articles-navbar">
                        <ul class="col-md-7 col-lg-10 col-xl-9 d-flex align-items-center justify-content-between categories">
                            {% for category in categories %}
                                {% if category.pk == selected_cat %}
                                <li class="categories__item">
                                    <span>{{category.name}}</span>
                                </li>
                                {% else %}
                                <li class="categories__item">
                                    <a href="{{category.get_absolute_url}}">{{category.name}}</a>
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>

                        <div class="col-md-4 col-lg-2 articles-funcs">
                            <a href="{% url 'add_article' %}">
                                <div class="articles-funcs__button button">Написать статью <i class="bi bi-pencil"></i></div>
                            </a>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            {% for article in articles %}
            <div class="col-sm-10 article-container">
                <ul class="d-flex justify-content-between article-info">
                    <li class="article-info__author">
                        <img class="article-info__author-avatar user-avatar" src="{{article.author.userprofile.profile_picture.url}}" alt="Аватарка">
                        <a href="{{article.author.userprofile.get_absolute_url}}">{{article.author}}</a>
                    </li>
                    <li class="article-info__time">{{article.create_time|date:"d-m-Y H:i"}}</li>
                </ul>

                <a href="{{article.get_absolute_url}}">
                    <h2 class="article-container__title">{{article.title}}</h2>
                </a>

                <ul class="d-flex article-tags">
                    {% for tag in article.tags.all %}
                    <li class="article-tags__item">
                        {% if tag == article.tags.all.last %}
                        <span>{{tag.name}}</span>
                        {% else %}
                        <span>{{tag.name}},</span>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>

                {% if article.cover_image %}
                <img class="article-container__image" src="{{article.cover_image.url}}" alt="изображение статьи">
                {% endif %}

                {% autoescape on %}
                <p class="article-container__content">{{article.content|safe|linebreaks|truncatewords:50}}</p>
                {% endautoescape %}

                <a class="article-container__button button" href="{{article.get_absolute_url}}">Читать дальше</a>

                <ul class="d-flex article-statistic">
                    <li class="article-statistic__item"><i class="bi bi-eye"></i> {{article.views_count.all.count}}</li>
                    <li class="article-statistic__item"><i class="bi bi-chat-left"></i> {{article.comments.all.count}}</li>
                </ul>
            </div>
            {% endfor %}
        </div>

        {% if page_obj.has_other_pages %}
        <div class="row">
            <div class="col-sm-10 pagination">
                <div class="container-fluid">
                    <div class="row justify-content-between">
                        {% if page_obj.has_previous %}
                        <div class="col-2 pagination-button">
                            <a href="?page={{page_obj.previous_page_number}}">Назад</a>
                        </div>
                        {% else %}
                        <div class="col-2"></div>
                        {% endif %}

                        <div class="col-8">
                            <nav class="container-fluid pages-nav">
                                <ul class="d-flex justify-content-center pages-list">
                                    {% for page in paginator.page_range %}
                                    {% if page_obj.number == page %}
                                    <li class="pages-list__item">
                                        <span>{{page}}</span>
                                    </li>
                                    {% elif page >= page_obj.number|add:-3 and page <= page_obj.number|add:3 %}
                                    <li class="pages-list__item">
                                        <a href="?page={{page}}">{{page}}</a>
                                    </li>
                                    {% endif %}
                                    {% endfor %}
                                </ul>
                            </nav>
                        </div>

                        {% if page_obj.has_next %}
                        <div class="col-2 pagination-button">
                            <a href="?page={{page_obj.next_page_number}}">Вперёд</a>
                        </div>
                        {% else %}
                        <div class="col-2"></div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}